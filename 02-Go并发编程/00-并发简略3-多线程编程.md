## 一 多线程编程概览

POSIX标准定义了线程和其操作方法，从Linux2.6开始，NPTL（基于POSIX）成为了其默认的线程实现。  
线程可以视为某个进程内部的控制流，其包括：
- 主线程：随着进程的启动而创建，必定拥有，因为进程必须有一个控制流持续运行。
- 其他线程：不一定拥有，由主线程或者其他线程创建（调用pthread_create函数）  

当拥有多个线程时，可以并发执行多个任务，即使某个任务被阻塞，也不会影响其他任务正常执行。  

注意：
- 线程不能独立于进程而存在，其生命周期不可能逾越其所属的进程生命周期  
- 与进程不同，线程不存在父子级别关系，同一进程中的任意2个线程之间的关系是平等的

线程自己私有的数据都存储在线程栈中，线程栈位于所属进程的虚拟内存地址中。不过，一个进程的很多资源会被所有线程共享，比如：代码段、数据段、堆、信号处理函数、当前进程持有的文件描述符等。所以，同一进程中的多个线程运行的一定是同一个程序，只不过具体的控制流和执行的函数可能不同。也正因如此，同一进程内的多线程共享数据变得很轻松，创建新线程也无需再复制资源了。

## 二 认识线程

#### 2.1 线程标识

每个线程也有属于自己的ID，称为TID，只在其所属的进程范围内唯一。  

贴士：Linux中的线程ID在系统范围内也是唯一的，且线程不存在后，该ID可被其他线程复用  

#### 2.2 线程调度  

调度器会把事件划分为极小的时间片并把这些时间片分配给不同的线程，以使众多线程都有机会在CPU上运行，也造成了我们多线程被并行运行的幻觉。  

## 三 线程同步

在多线程开发中，我们总是设法保证共享数据的一致性，除非该数据永远只被一个线程访问。  

保证共享数据一致性的最简单和最彻底的方法就是使该数据编程一个不变量。编程语言中使用常量来确保。但是类似计数器这样的数据变成常量是不现实的，必须通过额外手段来保证被多个线程共享变量的一致性，这就有了临界区的概念。  









